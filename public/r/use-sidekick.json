{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-sidekick",
  "type": "registry:hook",
  "title": "useSidekick Hook",
  "description": "React hook for accessing sidekick/cn context and AI functionality",
  "registryDependencies": "/r/sidekick-config.json",
  "files": [
    {
      "path": "src/hooks/use-sidekick.tsx",
      "content": "\"use client\";\n\nimport { isModelAllowed } from \"@/components/ai-elements/model-selector\";\nimport {\n  getAvailableModels,\n  registerGatewayModels,\n} from \"@/lib/ai-gateway-models\";\nimport type {\n  AIElementComponent,\n  SidekickConfig,\n  WorkflowDefinition,\n} from \"@/lib/sidekick-config\";\nimport { gateway } from \"ai\";\nimport * as React from \"react\";\ntype Message = {\n  id: string;\n  role: \"user\" | \"assistant\";\n  content: string;\n  sources?: { title: string; href: string }[];\n  reasoning?: { content: string; duration: number };\n  versions?: { id: string; content: string }[];\n};\n\ntype SidekickContextValue = {\n  config: SidekickConfig;\n  messages: Message[];\n  isLoading: boolean;\n  sendPrompt: (\n    prompt: string,\n    options?: Partial<SidekickConfig>,\n  ) => Promise<string>;\n  triggerWorkflow: (workflowId: string, input: any) => Promise<any>;\n  registerAIElement: (name: string, component: AIElementComponent) => void;\n  registeredElements: Record<string, AIElementComponent>;\n  workflows: WorkflowDefinition[];\n  addWorkflow: (workflow: WorkflowDefinition) => void;\n  clearMessages: () => void;\n  addMessage: (message: Omit<Message, \"id\">) => void;\n  discoverModels: () => Promise<void>;\n  availableModels: () => any[];\n};\n\nconst SidekickContext = React.createContext<SidekickContextValue | null>(null);\n\nexport function useSidekick() {\n  const context = React.useContext(SidekickContext);\n  if (!context) {\n    throw new Error(\"useSidekick must be used within SidekickProvider\");\n  }\n  return context;\n}\n\nexport function createSidekickContext(\n  config: SidekickConfig,\n  workflows: WorkflowDefinition[],\n): SidekickContextValue {\n  const [messages, setMessages] = React.useState<Message[]>([]);\n  const [isLoading, setIsLoading] = React.useState(false);\n  const [registeredElements, setRegisteredElements] = React.useState<\n    Record<string, AIElementComponent>\n  >({});\n  const [availableWorkflows, setAvailableWorkflows] =\n    React.useState<WorkflowDefinition[]>(workflows);\n\n  const sendPrompt = React.useCallback(\n    async (\n      prompt: string,\n      options?: Partial<SidekickConfig>,\n    ): Promise<string> => {\n      setIsLoading(true);\n      try {\n        const modelToUse = options?.model || config.model;\n\n        // Validate that the model is allowed according to config\n        if (modelToUse && !isModelAllowed(modelToUse, config.modelConfig)) {\n          throw new Error(\n            `Model \"${modelToUse}\" is not allowed according to current configuration`,\n          );\n        }\n\n        const response = await fetch(config.baseUrl || \"/api/ai\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            prompt,\n            model: modelToUse,\n            temperature: options?.temperature || config.temperature,\n            maxTokens: options?.maxTokens || config.maxTokens,\n          }),\n        });\n\n        if (!response.ok) {\n          throw new Error(`AI request failed: ${response.statusText}`);\n        }\n\n        const data = await response.json();\n        return data.response || data.text || \"No response received\";\n      } catch (error) {\n        console.error(\"sidekick/cn sendPrompt error:\", error);\n        throw error;\n      } finally {\n        setIsLoading(false);\n      }\n    },\n    [config],\n  );\n\n  const triggerWorkflow = React.useCallback(\n    async (workflowId: string, input: any): Promise<any> => {\n      const workflow = availableWorkflows.find((w) => w.id === workflowId);\n      if (!workflow) {\n        throw new Error(`Workflow \"${workflowId}\" not found`);\n      }\n\n      if (workflow.execute) {\n        return await workflow.execute(input);\n      }\n\n      const prompt = `${workflow.systemPrompt || \"\"}\\n\\nInput: ${JSON.stringify(input)}`;\n      return await sendPrompt(prompt);\n    },\n    [availableWorkflows, sendPrompt],\n  );\n\n  const registerAIElement = React.useCallback(\n    (name: string, component: AIElementComponent) => {\n      setRegisteredElements((prev) => ({ ...prev, [name]: component }));\n    },\n    [],\n  );\n\n  const addWorkflow = React.useCallback((workflow: WorkflowDefinition) => {\n    setAvailableWorkflows((prev) => [...prev, workflow]);\n  }, []);\n\n  const clearMessages = React.useCallback(() => {\n    setMessages([]);\n  }, []);\n\n  const addMessage = React.useCallback((message: Omit<Message, \"id\">) => {\n    setMessages((prev) => [...prev, { ...message, id: Date.now().toString() }]);\n  }, []);\n\n  const discoverModels = React.useCallback(\n    async (modelType?: \"language\" | \"embedding\"): Promise<void> => {\n      try {\n        const availableModels = await gateway.getAvailableModels();\n\n        // Filter models by type if requested\n        let models = availableModels.models;\n        if (modelType) {\n          models = models.filter((m: any) => m.modelType === modelType);\n        }\n\n        // Transform to our expected format\n        const transformedModels = models.map((model: any) => ({\n          id: model.id,\n          name: model.name || model.id.split(\"/\")[1] || model.id,\n          provider: model.id.split(\"/\")[0],\n          description: model.description || \"\",\n          contextWindow: model.contextWindow,\n          capabilities: model.capabilities || [],\n          modelType: model.modelType || \"language\",\n          pricing: model.pricing,\n        }));\n\n        registerGatewayModels(transformedModels);\n        console.log(\n          `Discovered ${transformedModels.length} models from AI Gateway${modelType ? ` (${modelType})` : \"\"}`,\n        );\n      } catch (error) {\n        // Silently fail - we'll use default models\n        console.warn(\"Could not discover models from AI Gateway:\", error);\n      }\n    },\n    [],\n  );\n\n  const availableModels = React.useCallback(() => {\n    return getAvailableModels();\n  }, []);\n\n  return {\n    config,\n    messages,\n    isLoading,\n    sendPrompt,\n    triggerWorkflow,\n    registerAIElement,\n    registeredElements,\n    workflows: availableWorkflows,\n    addWorkflow,\n    clearMessages,\n    addMessage,\n    discoverModels,\n    availableModels,\n  };\n}\n\nexport { SidekickContext };\n",
      "type": "registry:hook"
    }
  ]
}

