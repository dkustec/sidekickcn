{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ai-elements-model-selector",
  "type": "registry:component",
  "title": "AI Model Selector Elements",
  "description": "Model selection dropdown with search and grouping",
  "dependencies": [
    "lucide-react"
  ],
  "registryDependencies": [
    "popover",
    "input",
    "button",
    "badge"
  ],
  "files": [
    {
      "path": "src/components/ai-elements/model-selector.tsx",
      "content": "\"use client\";\n\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  filterModels,\n  getAvailableModels,\n  getModelById,\n  MODELS_BY_PROVIDER,\n  PROVIDER_LABELS,\n  type AIModel,\n  type AIProvider,\n} from \"@/lib/ai-gateway-models\";\nimport type { ModelConfig } from \"@/lib/sidekick-config\";\nimport { cn } from \"@/lib/utils\";\nimport { CheckIcon, ChevronDownIcon } from \"lucide-react\";\nimport * as React from \"react\";\n\n// Helper function to resolve allowed models based on config\nexport function resolveAllowedModels(config?: ModelConfig): AIModel[] {\n  const models = (config?.customModels as AIModel[]) || getAvailableModels();\n  const allowedModels = config?.allowedModels;\n\n  if (!allowedModels || allowedModels === \"*\") {\n    // All models allowed\n    return models;\n  }\n\n  if (allowedModels === \"none\") {\n    // Only default model allowed\n    const defaultModel = config?.defaultModel || \"openai/gpt-4.1-mini\";\n    return models.filter((m) => m.id === defaultModel);\n  }\n\n  if (Array.isArray(allowedModels)) {\n    // Specific list of models\n    return models.filter((m) => allowedModels.includes(m.id));\n  }\n\n  // Fallback to all models\n  return models;\n}\n\n// Helper function to check if a model is allowed\nexport function isModelAllowed(modelId: string, config?: ModelConfig): boolean {\n  const allowedModels = resolveAllowedModels(config);\n  return allowedModels.some((m) => m.id === modelId);\n}\n\nexport type ModelOption = {\n  id: string;\n  name: string;\n  provider: string;\n};\n\ntype ModelSelectorContextValue = {\n  selectedModel: string | null;\n  onModelSelect: (modelId: string) => void;\n  availableModels?: AIModel[];\n  config?: ModelConfig;\n};\n\nconst ModelSelectorContext =\n  React.createContext<ModelSelectorContextValue | null>(null);\n\nfunction useModelSelector() {\n  const context = React.useContext(ModelSelectorContext);\n  if (!context) {\n    throw new Error(\"useModelSelector must be used within ModelSelector\");\n  }\n  return context;\n}\n\ntype ModelSelectorProps = {\n  children: React.ReactNode;\n  defaultModel?: string;\n  onModelChange?: (modelId: string) => void;\n  open?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  config?: ModelConfig;\n};\n\nexport function CompoundModelSelector({\n  children,\n  defaultModel,\n  onModelChange,\n  open,\n  onOpenChange,\n  config,\n}: ModelSelectorProps) {\n  const [selectedModel, setSelectedModel] = React.useState<string | null>(\n    defaultModel || config?.defaultModel || null,\n  );\n\n  const handleModelSelect = React.useCallback(\n    (modelId: string) => {\n      setSelectedModel(modelId);\n      onModelChange?.(modelId);\n    },\n    [onModelChange],\n  );\n\n  const availableModels = React.useMemo(\n    () => resolveAllowedModels(config),\n    [config],\n  );\n\n  const shouldHide = config?.hideIfSingleModel && availableModels.length === 1;\n\n  if (shouldHide) {\n    return null;\n  }\n\n  return (\n    <ModelSelectorContext.Provider\n      value={{\n        selectedModel,\n        onModelSelect: handleModelSelect,\n        availableModels,\n        config,\n      }}\n    >\n      <Popover open={open} onOpenChange={onOpenChange}>\n        {children}\n      </Popover>\n    </ModelSelectorContext.Provider>\n  );\n}\n\nexport const ModelSelectorTrigger = PopoverTrigger;\n\ntype ModelSelectorContentProps = {\n  children: React.ReactNode;\n  className?: string;\n};\n\nexport function ModelSelectorContent({\n  children,\n  className,\n}: ModelSelectorContentProps) {\n  return (\n    <PopoverContent\n      className={cn(\"w-full max-w-sm sm:w-80 p-0\", className)}\n      align=\"start\"\n    >\n      {children}\n    </PopoverContent>\n  );\n}\n\ntype ModelSelectorInputProps = {\n  placeholder?: string;\n  value?: string;\n  onChange?: (value: string) => void;\n};\n\nexport function ModelSelectorInput({\n  placeholder = \"Search models...\",\n  value,\n  onChange,\n}: ModelSelectorInputProps) {\n  return (\n    <div className=\"border-b p-2\">\n      <Input\n        placeholder={placeholder}\n        value={value}\n        onChange={(e) => onChange?.(e.target.value)}\n        className=\"h-8\"\n      />\n    </div>\n  );\n}\n\ntype ModelSelectorListProps = {\n  children: React.ReactNode;\n};\n\nexport function ModelSelectorList({ children }: ModelSelectorListProps) {\n  return <div className=\"max-h-[300px] overflow-y-auto p-1\">{children}</div>;\n}\n\ntype ModelSelectorGroupProps = {\n  label: string;\n  children: React.ReactNode;\n};\n\nexport function ModelSelectorGroup({\n  label,\n  children,\n}: ModelSelectorGroupProps) {\n  return (\n    <div className=\"py-1\">\n      <div className=\"px-2 py-1.5 text-xs font-semibold text-muted-foreground\">\n        {label}\n      </div>\n      {children}\n    </div>\n  );\n}\n\ntype ModelSelectorItemProps = {\n  model: ModelOption;\n  children?: React.ReactNode;\n};\n\nexport function ModelSelectorItem({ model, children }: ModelSelectorItemProps) {\n  const { selectedModel, onModelSelect } = useModelSelector();\n\n  return (\n    <button\n      type=\"button\"\n      className={cn(\n        \"flex w-full items-center gap-2 rounded-sm px-2 py-1.5 text-sm hover:bg-muted\",\n        selectedModel === model.id && \"bg-muted\",\n      )}\n      onClick={() => onModelSelect(model.id)}\n    >\n      {children}\n      {selectedModel === model.id && (\n        <CheckIcon className=\"ml-auto h-4 w-4 shrink-0\" />\n      )}\n    </button>\n  );\n}\n\ntype ModelSelectorLogoGroupProps = {\n  children: React.ReactNode;\n};\n\nexport function ModelSelectorLogoGroup({\n  children,\n}: ModelSelectorLogoGroupProps) {\n  return <div className=\"flex items-center gap-2\">{children}</div>;\n}\n\ntype ModelSelectorLogoProps = {\n  src?: string;\n  alt: string;\n};\n\nexport function ModelSelectorLogo({ src, alt }: ModelSelectorLogoProps) {\n  if (!src) return null;\n\n  return (\n    <img\n      src={src || \"/placeholder.svg\"}\n      alt={alt}\n      className=\"h-5 w-5 rounded object-cover\"\n    />\n  );\n}\n\ntype ModelSelectorNameProps = {\n  children: React.ReactNode;\n};\n\nexport function ModelSelectorName({ children }: ModelSelectorNameProps) {\n  return <span className=\"flex-1 truncate text-left\">{children}</span>;\n}\n\nexport function ModelSelectorEmpty() {\n  return (\n    <div className=\"py-6 text-center text-sm text-muted-foreground\">\n      No models found\n    </div>\n  );\n}\n\ntype EnhancedModelSelectorProps = {\n  selectedModel?: string;\n  onModelChange?: (modelId: string) => void;\n  config?: ModelConfig;\n  className?: string;\n};\n\nexport function ModelSelector({\n  selectedModel,\n  onModelChange,\n  config,\n  className,\n}: EnhancedModelSelectorProps) {\n  const [open, setOpen] = React.useState(false);\n  const [search, setSearch] = React.useState(\"\");\n\n  const availableModels = React.useMemo(() => {\n    const models = resolveAllowedModels(config);\n    return search ? filterModels(models, search) : models;\n  }, [config, search]);\n\n  const currentModel = getModelById(\n    selectedModel || config?.defaultModel || \"openai/gpt-4.1-mini\",\n  );\n\n  if (config?.hideIfSingleModel && availableModels.length === 1) {\n    return null;\n  }\n\n  const groupedModels = config?.groupByProvider\n    ? Object.entries(MODELS_BY_PROVIDER).reduce(\n        (acc, [provider, models]) => {\n          const filtered = models.filter((m) => availableModels.includes(m));\n          if (filtered.length > 0) {\n            acc[provider as AIProvider] = filtered;\n          }\n          return acc;\n        },\n        {} as Record<AIProvider, AIModel[]>,\n      )\n    : { all: availableModels };\n\n  return (\n    <CompoundModelSelector\n      defaultModel={selectedModel}\n      onModelChange={onModelChange}\n      open={open}\n      onOpenChange={setOpen}\n      config={config}\n    >\n      <ModelSelectorTrigger asChild>\n        <Button\n          variant=\"outline\"\n          className={cn(\"justify-between gap-2\", className)}\n        >\n          <span className=\"flex items-center gap-2\">\n            {currentModel?.logo && (\n              <img\n                src={currentModel.logo || \"/placeholder.svg\"}\n                alt={currentModel.provider}\n                className=\"h-4 w-4\"\n              />\n            )}\n            <span>{currentModel?.name || \"Select Model\"}</span>\n          </span>\n          <ChevronDownIcon className=\"h-4 w-4 opacity-50\" />\n        </Button>\n      </ModelSelectorTrigger>\n      <ModelSelectorContent>\n        <ModelSelectorInput\n          placeholder=\"Search models...\"\n          value={search}\n          onChange={setSearch}\n        />\n        <ModelSelectorList>\n          {Object.entries(groupedModels).map(([provider, models]) => (\n            <ModelSelectorGroup\n              key={provider}\n              label={\n                config?.groupByProvider\n                  ? PROVIDER_LABELS[provider as AIProvider]\n                  : \"Models\"\n              }\n            >\n              {models.map((model: AIModel) => (\n                <ModelSelectorItem key={model.id} model={model}>\n                  <ModelSelectorLogoGroup>\n                    {model.logo && (\n                      <ModelSelectorLogo\n                        src={model.logo}\n                        alt={model.provider}\n                      />\n                    )}\n                    <div className=\"flex flex-1 flex-col items-start gap-0.5\">\n                      <ModelSelectorName>{model.name}</ModelSelectorName>\n                      <span className=\"text-xs text-muted-foreground\">\n                        {model.description}\n                      </span>\n                      <div className=\"flex gap-1\">\n                        {model.capabilities?.map((cap) => (\n                          <Badge\n                            key={cap}\n                            variant=\"secondary\"\n                            className=\"h-4 text-[10px]\"\n                          >\n                            {cap}\n                          </Badge>\n                        ))}\n                      </div>\n                    </div>\n                  </ModelSelectorLogoGroup>\n                </ModelSelectorItem>\n              ))}\n            </ModelSelectorGroup>\n          ))}\n          {availableModels.length === 0 && <ModelSelectorEmpty />}\n        </ModelSelectorList>\n      </ModelSelectorContent>\n    </CompoundModelSelector>\n  );\n}\n",
      "type": "registry:component"
    }
  ]
}
